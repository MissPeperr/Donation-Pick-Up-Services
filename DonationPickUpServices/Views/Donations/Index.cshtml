@model DonationPickUpServices.Models.ViewModels.DonationViewModels.DonationIndexViewModel
@using Microsoft.AspNetCore.Identity

@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Viewing Donations";
}

<h2>@ViewData["Title"]</h2>


@{ var user = await UserManager.GetUserAsync(User);}

@if (user.UserTypeId == 4)
{
    <table class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Donation.DateCreated)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Donation.Status)
                </th>
                <th>
                    @Html.DisplayNameFor(model => user.Address)
                </th>
            </tr>
        </thead>
        <tbody>
                @foreach (var donation in Model.Donations)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => donation.DateCreated)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => donation.Status.Title)
                        </td>
                        @foreach (var j in donation.Items)
                        {
                            <td>
                                @Html.DisplayFor(modelItem => j.ItemType.Title)
                            </td>
                        }
                        <td>
                            @Html.DisplayFor(modelItem => user.Address) <br />
                            @Html.DisplayFor(modelItem => user.City),
                            @Html.DisplayFor(modelItem => user.State) <br />
                            @Html.DisplayFor(modelItem => user.ZipCode)
                        </td>
                        <td></td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@donation.DonationId">Edit</a> |
                            <a asp-action="Details" asp-route-id="@donation.DonationId">Details</a> |
                            <a asp-action="Delete" asp-route-id="@donation.DonationId">Delete</a>
                        </td>
                    </tr>

                }
        </tbody>
    </table>
}
else if (user.UserTypeId == 2)
{
    <table class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Donation.DateCreated)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Donation.Status)
                </th>
                <th>
                    @Html.DisplayNameFor(model => user.Address)
                </th>
            </tr>
        </thead>
        <tbody>
                @foreach (var donation in Model.Donations)
                {

            <tr>
                <td>
                    @Html.DisplayFor(modelItem => donation.DateCreated)
                </td>

                <td>
                    @Html.DisplayFor(modelItem => donation.Status.Title)
                </td>

                @foreach (var j in donation.Items)
                {
                    <td>
                        @Html.DisplayFor(modelItem => j.ItemType.Title)
                    </td>

                    @if (j.ApplicationUserId == Model.AppUser.Id)
                    {
                        <td>
                            @Html.DisplayFor(modelItem => Model.AppUser.Address) <br />
                            @Html.DisplayFor(modelItem => Model.AppUser.City),
                            @Html.DisplayFor(modelItem => Model.AppUser.State) <br />
                            @Html.DisplayFor(modelItem => Model.AppUser.ZipCode)
                        </td>
                    }
                }
                <td></td>
                <td>
                    <a asp-action="Edit" asp-route-id="@donation.DonationId">Edit</a> |
                    <a asp-action="Details" asp-route-id="@donation.DonationId">Details</a> |
                    <a asp-action="Delete" asp-route-id="@donation.DonationId">Delete</a>
                </td>
            </tr>

                }
        </tbody>
    </table>
}
